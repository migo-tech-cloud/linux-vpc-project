#!/usr/bin/env python3
import argparse
import os

# Base directory for bash scripts
SCRIPT_DIR = os.path.join(os.path.dirname(__file__), "scripts")

def run_script(script_name, *args):
    script_path = os.path.join(SCRIPT_DIR, script_name)
    cmd = f"bash {script_path} {' '.join(args)}"
    print(f"\nüîπ Running: {cmd}\n")
    os.system(cmd)

def main():
    parser = argparse.ArgumentParser(
        description="Migo VPC Control CLI ‚Äî manage and demo Migo-vpc-1 & Migo-vpc-2 with peering and NAT"
    )
    subparsers = parser.add_subparsers(dest="command", help="Available commands")

    # Create both VPCs
    subparsers.add_parser("create", help="Create both Migo-vpc-1 and Migo-vpc-2")

    # Peer them
    subparsers.add_parser("peer", help="Peer Migo-vpc-1 and Migo-vpc-2 together")

    # Start/stop HTTP demo server
    start_srv = subparsers.add_parser("start-server", help="Run HTTP server in Migo-vpc-1 public subnet")
    stop_srv = subparsers.add_parser("stop-server", help="Stop all HTTP servers")

    # Cleanup
    subparsers.add_parser("cleanup", help="Clean up all Migo VPC components")

    args = parser.parse_args()

    if args.command == "create":
        print("üöÄ Creating Migo-vpc-1 and Migo-vpc-2...")
        run_script("create_vpc1.sh", "Migo-vpc-1", "enX0")
        run_script("create_vpc2.sh", "Migo-vpc-2", "enX0")

    elif args.command == "peer":
        print("ü§ù Peering Migo-vpc-1 and Migo-vpc-2...")
        run_script("peer_vpcs.sh", "Migo-vpc-1", "Migo-vpc-2")

    elif args.command == "start-server":
        run_script("start_server.sh", "Migo-vpc-1", "public")

    elif args.command == "stop-server":
        run_script("stop_server.sh")

    elif args.command == "cleanup":
        run_script("cleanup.sh")

    else:
        parser.print_help()

if __name__ == "__main__":
    main()

